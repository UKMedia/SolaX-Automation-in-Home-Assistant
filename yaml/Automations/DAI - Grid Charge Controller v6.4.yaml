# Code created/updated by ChatGPT (GPT-5 Thinking)
# Source: DAI + RBC Framework (Reference – Design-Doc v5.9)
# Sanitised for public repo – replace <PLACEHOLDERS> for your system before enabling writes

alias: DAI – Actual Demand 16-22 Tariff Switcher v1.3
description: >
  Code created/updated by ChatGPT (GPT-5 Thinking). v1.3 (PARAM-ONLY – entity
  alignment): Controls <YOUR_INPUT_SELECT_ENTITY> with canonical options
  `off` and `active_16-22`. Behaviour unchanged: sets active during 16:00–22:00
  and off otherwise, with HA-start self-heal. Change History: v1.3
  (entity/domain + option normalisation); v1.2 (selector id fix); v1.1
  (comments); v1.0 (initial).
triggers:
  - id: t_1600
    trigger: time
    at: "16:00:00"
  - id: t_2200
    trigger: time
    at: "22:00:00"
  - id: t_ha_start
    trigger: homeassistant
    event: start
conditions: []
actions:
  - choose:
      - conditions:
          - condition: trigger
            id: t_1600
        sequence:
          - action: input_select.select_option
            target:
              entity_id: <YOUR_INPUT_SELECT_ENTITY>
            data:
              option: active_16-22
          - action: logbook.log
            data:
              name: DAI – Tariff Switcher
              message: Switched mode to active_16-22 at 16:00.
      - conditions:
          - condition: trigger
            id: t_2200
        sequence:
          - action: input_select.select_option
            target:
              entity_id: <YOUR_INPUT_SELECT_ENTITY>
            data:
              option: "off"
          - action: logbook.log
            data:
              name: DAI – Tariff Switcher
              message: Switched mode to off at 22:00.
      - conditions:
          - condition: trigger
            id: t_ha_start
        sequence:
          - choose:
              - conditions:
                  - condition: time
                    after: "16:00:00"
                    before: "22:00:00"
                sequence:
                  - action: input_select.select_option
                    target:
                      entity_id: <YOUR_INPUT_SELECT_ENTITY>
                    data:
                      option: active_16-22
                  - action: logbook.log
                    data:
                      name: DAI – Tariff Switcher
                      message: HA start self-heal set mode to active_16-22.
            default:
              - action: input_select.select_option
                target:
                  entity_id: <YOUR_INPUT_SELECT_ENTITY>
                data:
                  option: "off"
              - action: logbook.log
                data:
                  name: DAI – Tariff Switcher
                  message: HA start self-heal set mode to off (outside 16:00–22:00).
    default:
      - action: logbook.log
        data:
          name: DAI – Tariff Switcher
          message: Default branch hit – no change.
mode: single
